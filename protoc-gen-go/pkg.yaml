name: protoc-gen-go
dependencies:
  - stage: base
  - stage: golang
steps:
  - sources:
      - url: https://github.com/protocolbuffers/protobuf-go/archive/v1.25.0.tar.gz
        destination: protobuf-go.tar.gz
        sha256: c1c04d6e36c0d0fb6f3374197f9025d7e6df13f38a974098be020617c00fbaf2
        sha512: f5e4c2399174ae41d73f902b189f792a22856e88cfdf2c09a9f39871179f2e937d2de24a46fc5e95b6c3870fab17d832480b95be49d27d8664ec2e0a4706cf3b
    prepare:
      - |
        tar -xzf protobuf-go.tar.gz --strip-components=1
    build:
      - |
        export PATH=${TOOLCHAIN}/go/bin:${PATH}
        export GO111MODULE=on
        cd cmd/protoc-gen-go
        go build .
    install:
      - |
        mkdir -p /rootfs${TOOLCHAIN}/bin
        mv cmd/protoc-gen-go/protoc-gen-go /rootfs${TOOLCHAIN}/bin
finalize:
  - from: /rootfs
    to: /
